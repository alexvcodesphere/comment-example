schemaVersion: v0.2
prepare:
  steps:
    - name: update node
      command: sudo n lts
    - name: Install & build commenting ui
      command: cd commenting-ui && npm install && npm run build
    - name: install proxy
      command: cd proxy && npm install
    - name: Install target app
      command: cd target-app && npm install
test:
  steps: []
run:
  comment-ui:
    steps:
      - command: sudo n lts
      - command: cd commenting-ui && node server.js
    plan: 8
    replicas: 1
    network:
      ports:
        - port: 3000
          isPublic: false
      paths:
        - port: 3000
          path: /commenting-ui
    env:
      NODE_ENV: prod
  target-app:
    steps:
      - name: update node
        command: sudo n lts
      - command: cd target-app && node server.js
    plan: 8
    replicas: 1
    network:
      ports:
        - port: 3000
          isPublic: false
      paths:
        - port: 3000
          path: /target
    env:
      NODE_ENV: prod
  cs-proxy:
    steps:
      - command: sudo n lts
      - command: cd proxy && node server.js
    plan: 8
    replicas: 1
    network:
      ports:
        - port: 3000
          isPublic: false
      paths:
        - port: 3000
          path: /
    env:
      NODE_ENV: prod
      TARGET_URL: http://localhost:3000/target
      TOOLS_URL: http://localhost:3000/commenting-ui
